"use strict";(self.webpackChunkphysical_ai_humanoid_robotics_textbook=self.webpackChunkphysical_ai_humanoid_robotics_textbook||[]).push([[961],{3006:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"modules/m2-digital-twin/m2-sensor-simulation","title":"Lesson 3: Sensor Simulation","description":"Simulate realistic sensors in Gazebo: cameras (RGB/depth), IMU, force/torque sensors. Add noise and calibrate for sim-to-real transfer.","source":"@site/docs/modules/m2-digital-twin/m2-sensor-simulation.mdx","sourceDirName":"modules/m2-digital-twin","slug":"/modules/m2-digital-twin/m2-sensor-simulation","permalink":"/docs/modules/m2-digital-twin/m2-sensor-simulation","draft":false,"unlisted":false,"editUrl":"https://github.com/Danishhshahid/Physical-AI-Humanoid-Robotics-Book/tree/main/website/docs/modules/m2-digital-twin/m2-sensor-simulation.mdx","tags":[],"version":"current","frontMatter":{"id":"m2-sensor-simulation","title":"Lesson 3: Sensor Simulation","sidebar_label":"L3: Sensor Simulation","description":"Simulate realistic sensors in Gazebo: cameras (RGB/depth), IMU, force/torque sensors. Add noise and calibrate for sim-to-real transfer."},"sidebar":"tutorialSidebar","previous":{"title":"L2: Unity Rendering","permalink":"/docs/modules/m2-digital-twin/m2-unity-rendering"},"next":{"title":"M3: Overview","permalink":"/docs/modules/m3-isaac/m3-overview"}}');var s=i(4848),a=i(8453);const o={id:"m2-sensor-simulation",title:"Lesson 3: Sensor Simulation",sidebar_label:"L3: Sensor Simulation",description:"Simulate realistic sensors in Gazebo: cameras (RGB/depth), IMU, force/torque sensors. Add noise and calibrate for sim-to-real transfer."},t=void 0,l={},c=[{value:"Why Simulate Sensors?",id:"why-simulate-sensors",level:2},{value:"Camera Simulation in Gazebo",id:"camera-simulation-in-gazebo",level:2},{value:"Subscribe to Camera in ROS 2",id:"subscribe-to-camera-in-ros-2",level:3},{value:"IMU Simulation",id:"imu-simulation",level:2},{value:"Read IMU in ROS 2",id:"read-imu-in-ros-2",level:3},{value:"Force/Torque Sensors",id:"forcetorque-sensors",level:2},{value:"Monitor Gripper Force",id:"monitor-gripper-force",level:3},{value:"Depth Camera (LiDAR)",id:"depth-camera-lidar",level:2},{value:"Domain Randomization for Sensors",id:"domain-randomization-for-sensors",level:2},{value:"Hands-On Project",id:"hands-on-project",level:2},{value:"Next Module",id:"next-module",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"why-simulate-sensors",children:"Why Simulate Sensors?"}),"\n",(0,s.jsx)(n.p,{children:"Real sensors have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\ud83d\udcf7 ",(0,s.jsx)(n.strong,{children:"Noise and blur"})," (cameras)"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd04 ",(0,s.jsx)(n.strong,{children:"Drift"})," (IMU, encoders)"]}),"\n",(0,s.jsxs)(n.li,{children:["\u26a1 ",(0,s.jsx)(n.strong,{children:"Latency"})," (communication delays)"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,s.jsx)(n.strong,{children:"Limited range and accuracy"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Training with simulated sensors \u2192 Policies robust to real-world imperfections."}),"\n",(0,s.jsx)(n.h2,{id:"camera-simulation-in-gazebo",children:"Camera Simulation in Gazebo"}),"\n",(0,s.jsx)(n.p,{children:"Add a camera to your URDF:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<link name="camera_link">\n  <inertial>\n    <mass value="0.1"/>\n    <inertia ixx="0.001" ixy="0" ixz="0"\n             iyy="0.001" iyz="0" izz="0.001"/>\n  </inertial>\n  <collision>\n    <geometry>\n      <box size="0.02 0.02 0.02"/>\n    </geometry>\n  </collision>\n  <visual>\n    <geometry>\n      <box size="0.02 0.02 0.02"/>\n    </geometry>\n  </visual>\n</link>\n\n\x3c!-- Mount camera on gripper --\x3e\n<joint name="camera_joint" type="fixed">\n  <parent link="gripper"/>\n  <child link="camera_link"/>\n  <origin xyz="0 0 0.05" rpy="0 0 0"/>\n</joint>\n\n\x3c!-- Gazebo plugin for camera sensor --\x3e\n<gazebo reference="camera_link">\n  <sensor name="camera" type="camera">\n    <camera>\n      <horizontal_fov>1.047</horizontal_fov>  \x3c!-- 60 degrees --\x3e\n      <image>\n        <width>640</width>\n        <height>480</height>\n        <format>R8G8B8</format>\n      </image>\n      <clip>\n        <near>0.05</near>\n        <far>50.0</far>\n      </clip>\n      <noise>\n        <type>gaussian</type>\n        <mean>0.0</mean>\n        <stddev>0.007</stddev>\n      </noise>\n    </camera>\n    <plugin filename="ignition-gazebo-camera-video-recorder-system"\n            name="ignition::gazebo::systems::VideoRecorder">\n      <video_name>camera_output</video_name>\n    </plugin>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"subscribe-to-camera-in-ros-2",children:"Subscribe to Camera in ROS 2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import Image\nfrom cv_bridge import CvBridge\nimport cv2\n\nclass CameraProcessor(Node):\n    def __init__(self):\n        super().__init__('camera_processor')\n        self.subscription = self.create_subscription(\n            Image,\n            '/camera/image_raw',\n            self.camera_callback,\n            10\n        )\n        self.cv_bridge = CvBridge()\n\n    def camera_callback(self, msg):\n        # Convert ROS Image to OpenCV\n        frame = self.cv_bridge.imgmsg_to_cv2(msg, desired_encoding='bgr8')\n\n        # Process (e.g., object detection)\n        # ...\n\n        # Publish results\n        # ...\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = CameraProcessor()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"imu-simulation",children:"IMU Simulation"}),"\n",(0,s.jsx)(n.p,{children:"Add accelerometer + gyroscope:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<gazebo reference="torso_link">\n  <sensor name="imu_sensor" type="imu">\n    <always_on>true</always_on>\n    <update_rate>200</update_rate>  \x3c!-- 200 Hz --\x3e\n    <plugin filename="ignition-gazebo-imu-system" name="ignition::gazebo::systems::Imu">\n      \x3c!-- Accelerometer noise --\x3e\n      <accel_x_noise mean="0.0" stddev="0.02"/>\n      <accel_y_noise mean="0.0" stddev="0.02"/>\n      <accel_z_noise mean="0.0" stddev="0.02"/>\n\n      \x3c!-- Gyroscope noise --\x3e\n      <gyro_x_noise mean="0.0" stddev="0.004"/>\n      <gyro_y_noise mean="0.0" stddev="0.004"/>\n      <gyro_z_noise mean="0.0" stddev="0.004"/>\n\n      \x3c!-- Bias (drift) --\x3e\n      <accel_bias_x_noise mean="0.001" stddev="0.0001"/>\n      <accel_bias_y_noise mean="0.001" stddev="0.0001"/>\n      <accel_bias_z_noise mean="0.001" stddev="0.0001"/>\n    </plugin>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"read-imu-in-ros-2",children:"Read IMU in ROS 2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from sensor_msgs.msg import Imu\nimport numpy as np\n\nclass BalanceController(Node):\n    def __init__(self):\n        super().__init__('balance_controller')\n        self.imu_sub = self.create_subscription(\n            Imu,\n            '/imu/data',\n            self.imu_callback,\n            10\n        )\n        self.accel = np.zeros(3)\n        self.angular_vel = np.zeros(3)\n\n    def imu_callback(self, msg):\n        # Extract linear acceleration\n        self.accel = np.array([\n            msg.linear_acceleration.x,\n            msg.linear_acceleration.y,\n            msg.linear_acceleration.z\n        ])\n\n        # Extract angular velocity\n        self.angular_vel = np.array([\n            msg.angular_velocity.x,\n            msg.angular_velocity.y,\n            msg.angular_velocity.z\n        ])\n\n        # Use for balance control\n        # Example: Estimate center-of-mass acceleration\n        com_accel_z = self.accel[2]  # Vertical acceleration\n\n        if com_accel_z < 0:  # Falling forward\n            self.adjust_hip_angle(delta=0.01)  # Lean back\n"})}),"\n",(0,s.jsx)(n.h2,{id:"forcetorque-sensors",children:"Force/Torque Sensors"}),"\n",(0,s.jsx)(n.p,{children:"Simulate gripper force feedback:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<gazebo reference="gripper_link">\n  <sensor name="force_torque" type="force_torque">\n    <always_on>true</always_on>\n    <update_rate>100</update_rate>\n    <plugin filename="ignition-gazebo-force-torque-system"\n            name="ignition::gazebo::systems::ForceTorque">\n      <force_x_noise mean="0.0" stddev="0.1"/>\n      <force_y_noise mean="0.0" stddev="0.1"/>\n      <force_z_noise mean="0.0" stddev="0.1"/>\n      <torque_x_noise mean="0.0" stddev="0.01"/>\n      <torque_y_noise mean="0.0" stddev="0.01"/>\n      <torque_z_noise mean="0.0" stddev="0.01"/>\n    </plugin>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"monitor-gripper-force",children:"Monitor Gripper Force"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from geometry_msgs.msg import WrenchStamped\n\nclass GripperController(Node):\n    def __init__(self):\n        super().__init__('gripper_controller')\n        self.ft_sub = self.create_subscription(\n            WrenchStamped,\n            '/gripper/force_torque',\n            self.ft_callback,\n            10\n        )\n\n    def ft_callback(self, msg):\n        force_z = msg.wrench.force.z  # Vertical grip force\n\n        if force_z > 50:  # Too much force\n            self.reduce_gripper_current()\n        elif force_z < 10:  # Object slipping\n            self.increase_gripper_current()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"depth-camera-lidar",children:"Depth Camera (LiDAR)"}),"\n",(0,s.jsx)(n.p,{children:"Simulate 3D depth sensing:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<gazebo reference="head_link">\n  <sensor name="depth_camera" type="depth_camera">\n    <always_on>true</always_on>\n    <update_rate>30</update_rate>\n    <camera>\n      <horizontal_fov>1.047</horizontal_fov>\n      <image>\n        <width>640</width>\n        <height>480</height>\n      </image>\n      <clip>\n        <near>0.1</near>\n        <far>5.0</far>\n      </clip>\n    </camera>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,s.jsx)(n.p,{children:"Process depth data for obstacle avoidance:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from sensor_msgs.msg import Image\nimport numpy as np\n\nclass ObstacleDetector(Node):\n    def depth_callback(self, msg):\n        # Convert to numpy array\n        depth_array = np.frombuffer(msg.data, dtype=np.uint16)\n        depth_image = depth_array.reshape((msg.height, msg.width))\n\n        # Find closest obstacle\n        min_distance = np.min(depth_image[depth_image > 0])\n\n        if min_distance < 0.3:  # 30 cm warning\n            self.get_logger().warn("Obstacle detected!")\n            self.emergency_stop()\n'})}),"\n",(0,s.jsx)(n.h2,{id:"domain-randomization-for-sensors",children:"Domain Randomization for Sensors"}),"\n",(0,s.jsx)(n.p,{children:"Train policies robust to sensor uncertainty:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import random\nimport subprocess\n\ndef randomize_simulation():\n    \"\"\"Randomize sensor parameters before each training episode.\"\"\"\n\n    # Randomize camera noise\n    camera_noise = random.uniform(0.001, 0.02)\n\n    # Randomize IMU drift\n    imu_drift = random.uniform(0.0001, 0.001)\n\n    # Randomize force sensor noise\n    ft_noise = random.uniform(0.01, 0.5)\n\n    # Rewrite URDF/SDF with new parameters\n    # ...\n\n    # Restart Gazebo simulation\n    subprocess.run(['pkill', 'gazebo'])\n    subprocess.run(['gazebo', 'randomized_world.sdf'])\n"})}),"\n",(0,s.jsx)(n.h2,{id:"hands-on-project",children:"Hands-On Project"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Simulate a manipulation task with complete sensor suite:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Create a scene with:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A table with 3 objects"}),"\n",(0,s.jsx)(n.li,{children:"A humanoid arm with 6-DOF"}),"\n",(0,s.jsx)(n.li,{children:"RGB camera on gripper"}),"\n",(0,s.jsx)(n.li,{children:"Depth sensor on head"}),"\n",(0,s.jsx)(n.li,{children:"IMU on torso"}),"\n",(0,s.jsx)(n.li,{children:"F/T sensor on wrist"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Implement controllers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Vision-based object detection"}),"\n",(0,s.jsx)(n.li,{children:"Balance control using IMU"}),"\n",(0,s.jsx)(n.li,{children:"Grasp force control using F/T sensor"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Train a policy that:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sees an object with the camera"}),"\n",(0,s.jsx)(n.li,{children:"Plans a grasp trajectory"}),"\n",(0,s.jsx)(n.li,{children:"Executes with force feedback"}),"\n",(0,s.jsx)(n.li,{children:"Verifies success with depth sensor"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-module",children:"Next Module"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/docs/modules/m3-isaac/m3-overview",children:"Module 3: The AI-Robot Brain (NVIDIA Isaac)"})})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>t});var r=i(6540);const s={},a=r.createContext(s);function o(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);